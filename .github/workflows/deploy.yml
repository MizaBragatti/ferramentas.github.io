name: Deploy to GitHub Pages with Firebase Config

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Inject Firebase Configuration
      run: |
        # Criar arquivo de configuraÃ§Ã£o com as secrets
        cat > presenciais/firebase-env.js << EOF
        // ConfiguraÃ§Ã£o Firebase injetada pelo GitHub Actions
        window.FIREBASE_API_KEY = '${{ secrets.FIREBASE_API_KEY }}';
        window.FIREBASE_AUTH_DOMAIN = '${{ secrets.FIREBASE_AUTH_DOMAIN }}';
        window.FIREBASE_PROJECT_ID = '${{ secrets.FIREBASE_PROJECT_ID }}';
        window.FIREBASE_STORAGE_BUCKET = '${{ secrets.FIREBASE_STORAGE_BUCKET }}';
        window.FIREBASE_MESSAGING_SENDER_ID = '${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}';
        window.FIREBASE_APP_ID = '${{ secrets.FIREBASE_APP_ID }}';
        console.log('ğŸ” VariÃ¡veis Firebase carregadas via GitHub Actions');
        EOF
        
    - name: Update HTML to include environment file
      run: |
        # Adicionar o script de configuraÃ§Ã£o antes do firebase-config-safe.js
        sed -i 's|<script src="firebase-config-safe.js"></script>|<script src="firebase-env.js"></script>\n    <script src="firebase-config-safe.js"></script>|' presenciais/presenciais.html
        
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/main'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        
    - name: Success notification
      run: |
        echo "âœ… Deploy realizado com sucesso!"
        echo "ğŸ” ConfiguraÃ§Ã£o Firebase injetada"
        echo "ğŸŒ Site disponÃ­vel em: https://${{ github.repository_owner }}.github.io/ferramentas/"