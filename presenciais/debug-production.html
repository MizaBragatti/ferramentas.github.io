<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug - HTML Produ√ß√£o</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .section { margin: 20px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff; background: #f8f9fa; }
        pre { background: #222; color: #fff; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; background: #007bff; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Verifica√ß√£o do HTML de Produ√ß√£o</h1>
        
        <div class="section">
            <h3>üéØ Objetivo</h3>
            <p>Verificar se o GitHub Actions est√° injetando as vari√°veis Firebase no HTML de produ√ß√£o.</p>
            <p><strong>Ambiente:</strong> <span id="environment"></span></p>
            <p><strong>URL:</strong> <span id="currentUrl"></span></p>
        </div>

        <div class="section">
            <h3>üîë Vari√°veis Firebase</h3>
            <div id="firebaseVars"></div>
        </div>

        <div class="section">
            <h3>üìÑ An√°lise do HTML</h3>
            <button onclick="analyzeCurrentHTML()">üîç Analisar HTML Atual</button>
            <div id="htmlAnalysis"></div>
        </div>

        <div class="section">
            <h3>üåê View Source</h3>
            <p>Para verifica√ß√£o manual:</p>
            <button onclick="openViewSource()">üìã Abrir View Source</button>
            <p><small>Procure por scripts com "FIREBASE_" no HTML</small></p>
        </div>
    </div>

    <script>
        // Detectar ambiente
        const isProduction = window.location.hostname === 'mizabragatti.github.io';
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        document.getElementById('environment').textContent = isProduction ? 'üåê Produ√ß√£o (GitHub Pages)' : 
                                                           isLocal ? 'üè† Local' : '‚ùì Desconhecido';
        document.getElementById('currentUrl').textContent = window.location.href;

        // Verificar vari√°veis Firebase
        function checkFirebaseVars() {
            const vars = {
                'window.FIREBASE_CONFIG': window.FIREBASE_CONFIG,
                'window.FIREBASE_API_KEY': window.FIREBASE_API_KEY,
                'window.FIREBASE_AUTH_DOMAIN': window.FIREBASE_AUTH_DOMAIN,
                'window.FIREBASE_PROJECT_ID': window.FIREBASE_PROJECT_ID,
                'window.FIREBASE_STORAGE_BUCKET': window.FIREBASE_STORAGE_BUCKET,
                'window.FIREBASE_MESSAGING_SENDER_ID': window.FIREBASE_MESSAGING_SENDER_ID,
                'window.FIREBASE_APP_ID': window.FIREBASE_APP_ID
            };

            let html = '<table border="1" style="width: 100%; border-collapse: collapse;">';
            html += '<tr style="background: #f8f9fa;"><th>Vari√°vel</th><th>Status</th><th>Tipo</th><th>Preview</th></tr>';

            let foundVars = 0;
            for (const [key, value] of Object.entries(vars)) {
                const present = value !== undefined && value !== null;
                if (present) foundVars++;
                
                const type = typeof value;
                const preview = present ? 
                    (type === 'object' ? 'Object {...}' : 
                     type === 'string' && value.length > 20 ? value.substring(0, 15) + '...' : 
                     String(value).substring(0, 25)) 
                    : 'undefined';
                
                const rowClass = present ? 'success' : 'error';
                html += `<tr style="background: ${present ? '#d4edda' : '#f8d7da'};">
                    <td><code>${key}</code></td>
                    <td>${present ? '‚úÖ Presente' : '‚ùå Ausente'}</td>
                    <td>${type}</td>
                    <td><code>${preview}</code></td>
                </tr>`;
            }
            html += '</table>';
            
            html += `<div style="margin-top: 15px;">
                <strong>Resumo:</strong> ${foundVars}/7 vari√°veis encontradas
                ${foundVars === 0 ? 
                    '<div style="color: #dc3545; font-weight: bold;">‚ùå NENHUMA vari√°vel Firebase encontrada!</div>' :
                    foundVars === 7 ? 
                        '<div style="color: #28a745; font-weight: bold;">‚úÖ Todas as vari√°veis presentes!</div>' :
                        '<div style="color: #ffc107; font-weight: bold;">‚ö†Ô∏è Algumas vari√°veis faltando</div>'
                }
            </div>`;

            document.getElementById('firebaseVars').innerHTML = html;
            
            // Log no console
            console.log('üîç Debug Firebase Variables:');
            console.table(vars);
            
            return foundVars;
        }

        // Analisar HTML atual
        async function analyzeCurrentHTML() {
            const resultDiv = document.getElementById('htmlAnalysis');
            resultDiv.innerHTML = '<p>üîÑ Analisando HTML...</p>';

            try {
                const response = await fetch(window.location.href);
                const htmlContent = await response.text();
                
                // Procurar por evid√™ncias de inje√ß√£o
                const checks = {
                    'Cont√©m FIREBASE_API_KEY': htmlContent.includes('FIREBASE_API_KEY'),
                    'Cont√©m FIREBASE_CONFIG': htmlContent.includes('FIREBASE_CONFIG'),
                    'Cont√©m window.FIREBASE_': htmlContent.includes('window.FIREBASE_'),
                    'Cont√©m coment√°rio GitHub Actions': htmlContent.includes('GitHub Actions'),
                    'Scripts Firebase encontrados': (htmlContent.match(/window\.FIREBASE_[A-Z_]+\s*=/g) || []).length,
                    'Tamanho do HTML': `${htmlContent.length} caracteres`
                };

                // Extrair scripts Firebase
                const firebaseScripts = [];
                const scriptRegex = /<script[^>]*>([\s\S]*?)<\/script>/gi;
                let match;
                
                while ((match = scriptRegex.exec(htmlContent)) !== null) {
                    const scriptContent = match[1];
                    if (scriptContent.includes('FIREBASE_') && 
                        (scriptContent.includes('window.FIREBASE_') || scriptContent.includes('GitHub Actions'))) {
                        firebaseScripts.push(scriptContent.trim());
                    }
                }

                let html = '<h4>üìä An√°lise Completa:</h4>';
                html += '<table border="1" style="width: 100%; border-collapse: collapse;">';
                html += '<tr style="background: #f8f9fa;"><th>Verifica√ß√£o</th><th>Resultado</th></tr>';

                for (const [check, result] of Object.entries(checks)) {
                    const isPositive = typeof result === 'boolean' ? result : 
                                     typeof result === 'number' ? result > 0 : 
                                     true;
                    
                    html += `<tr style="background: ${isPositive ? '#d4edda' : '#f8d7da'};">
                        <td>${check}</td>
                        <td>${typeof result === 'boolean' ? (result ? '‚úÖ Sim' : '‚ùå N√£o') : result}</td>
                    </tr>`;
                }
                html += '</table>';

                if (firebaseScripts.length > 0) {
                    html += '<h4>üî• Scripts Firebase Encontrados:</h4>';
                    firebaseScripts.forEach((script, index) => {
                        html += `<h5>Script ${index + 1}:</h5>`;
                        html += `<pre>${script.length > 800 ? script.substring(0, 800) + '\n\n... (truncado - total: ' + script.length + ' chars)' : script}</pre>`;
                    });
                } else {
                    html += '<div style="background: #f8d7da; padding: 15px; margin: 15px 0; border-radius: 5px; border-left: 4px solid #dc3545;">';
                    html += '<h4>‚ùå PROBLEMA IDENTIFICADO!</h4>';
                    html += '<p><strong>Nenhum script Firebase foi encontrado no HTML!</strong></p>';
                    html += '<p>Isso significa que o GitHub Actions <strong>N√ÉO est√° injetando</strong> as vari√°veis no HTML durante o deployment.</p>';
                    html += '</div>';
                }

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Erro ao analisar HTML: ${error.message}</div>`;
            }
        }

        function openViewSource() {
            window.open('view-source:' + window.location.href, '_blank');
        }

        // Executar verifica√ß√£o inicial
        document.addEventListener('DOMContentLoaded', function() {
            const varsFound = checkFirebaseVars();
            
            console.log(`üîç Ambiente detectado: ${isProduction ? 'Produ√ß√£o' : 'Local/Dev'}`);
            console.log(`üîë Vari√°veis Firebase encontradas: ${varsFound}/7`);
            
            if (isProduction && varsFound === 0) {
                console.error('‚ùå PROBLEMA: Nenhuma vari√°vel Firebase em produ√ß√£o!');
                console.log('üí° Isso indica que o GitHub Actions n√£o est√° injetando as vari√°veis.');
            }
        });
    </script>
</body>
</html>