<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste de Din√¢mica Firebase</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background: #e6ffe6; border-left: 4px solid #44ff44; }
        .error { background: #ffe6e6; border-left: 4px solid #ff4444; }
        .info { background: #e6f3ff; border-left: 4px solid #4488ff; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-test { background: #007bff; color: white; }
        .btn-clear { background: #dc3545; color: white; }
        pre { background: #222; color: #fff; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .log { margin: 5px 0; padding: 5px; border-radius: 3px; font-family: monospace; }
        .log.info { background: #d1ecf1; color: #0c5460; }
        .log.success { background: #d4edda; color: #155724; }
        .log.error { background: #f8d7da; color: #721c24; }
        .log.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Din√¢mica Firebase (Chaves Falsas)</h1>
        
        <div class="test-section warning">
            <h3>‚ö†Ô∏è Aviso Importante</h3>
            <p>Este teste usa <strong>chaves FALSAS</strong> para verificar apenas a din√¢mica de inje√ß√£o de vari√°veis.</p>
            <p>‚úÖ O que funcionar√°: Detec√ß√£o de vari√°veis, logs, fluxo de configura√ß√£o</p>
            <p>‚ùå O que falhar√°: Conex√£o com Firebase real (esperado)</p>
        </div>

        <div class="test-section info">
            <h3>üîß Controles de Teste</h3>
            <button class="btn-test" onclick="injectTestVars()">üîë Injetar Vari√°veis de Teste</button>
            <button class="btn-test" onclick="testConfigLoad()">üîç Testar Carregamento de Config</button>
            <button class="btn-test" onclick="testFirebaseInit()">üöÄ Testar Inicializa√ß√£o Firebase</button>
            <button class="btn-clear" onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
        </div>

        <div class="test-section">
            <h3>üìä Status das Vari√°veis</h3>
            <div id="varStatus"></div>
        </div>

        <div class="test-section">
            <h3>üìã Logs de Teste</h3>
            <div id="testLogs"></div>
        </div>

        <div class="test-section">
            <h3>üîç Console do Navegador</h3>
            <p>Abra o DevTools (F12) ‚Üí Console para ver logs detalhados</p>
        </div>
    </div>

    <!-- Carregando scripts do Firebase -->
    <script src="firebase-config-universal.js"></script>
    <script src="firebase-config-safe.js"></script>

    <script>
        let logContainer = document.getElementById('testLogs');
        
        function addLog(message, type = 'info') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Tamb√©m enviar para console
            console.log(`%c${message}`, `color: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#007bff'}`);
        }

        function clearLogs() {
            logContainer.innerHTML = '';
            console.clear();
            addLog('Logs limpos', 'info');
        }

        function updateVarStatus() {
            const vars = {
                'FIREBASE_CONFIG': window.FIREBASE_CONFIG,
                'FIREBASE_API_KEY': window.FIREBASE_API_KEY,
                'FIREBASE_AUTH_DOMAIN': window.FIREBASE_AUTH_DOMAIN,
                'FIREBASE_PROJECT_ID': window.FIREBASE_PROJECT_ID,
                'FIREBASE_STORAGE_BUCKET': window.FIREBASE_STORAGE_BUCKET,
                'FIREBASE_MESSAGING_SENDER_ID': window.FIREBASE_MESSAGING_SENDER_ID,
                'FIREBASE_APP_ID': window.FIREBASE_APP_ID
            };

            let html = '<table border="1" style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th>Vari√°vel</th><th>Status</th><th>Tipo</th><th>Preview</th></tr>';

            for (const [key, value] of Object.entries(vars)) {
                const present = value !== undefined && value !== null;
                const type = typeof value;
                const preview = present ? 
                    (type === 'string' && value.length > 15 ? value.substring(0, 12) + '...' : String(value).substring(0, 20)) 
                    : 'undefined';
                
                html += `<tr>
                    <td><code>${key}</code></td>
                    <td>${present ? '‚úÖ' : '‚ùå'}</td>
                    <td>${type}</td>
                    <td><code>${preview}</code></td>
                </tr>`;
            }
            html += '</table>';

            document.getElementById('varStatus').innerHTML = html;
        }

        function injectTestVars() {
            addLog('üîë Injetando vari√°veis de teste...', 'info');
            
            // Simular inje√ß√£o de vari√°veis (como o GitHub Actions faria)
            window.FIREBASE_API_KEY = 'AIzaSyDEMO123456789abcdefghijklmnopqrstuv';
            window.FIREBASE_AUTH_DOMAIN = 'projeto-teste.firebaseapp.com';
            window.FIREBASE_PROJECT_ID = 'projeto-teste-id';
            window.FIREBASE_STORAGE_BUCKET = 'projeto-teste.appspot.com';
            window.FIREBASE_MESSAGING_SENDER_ID = '123456789012';
            window.FIREBASE_APP_ID = '1:123456789012:web:abc123def456ghi789';
            
            // Criar objeto de configura√ß√£o
            window.FIREBASE_CONFIG = {
                apiKey: window.FIREBASE_API_KEY,
                authDomain: window.FIREBASE_AUTH_DOMAIN,
                projectId: window.FIREBASE_PROJECT_ID,
                storageBucket: window.FIREBASE_STORAGE_BUCKET,
                messagingSenderId: window.FIREBASE_MESSAGING_SENDER_ID,
                appId: window.FIREBASE_APP_ID
            };

            window.FIREBASE_TEST_MODE = true;
            
            addLog('‚úÖ Vari√°veis de teste injetadas!', 'success');
            addLog('‚ö†Ô∏è Modo de teste ativo - Firebase n√£o conectar√°', 'warning');
            
            updateVarStatus();
        }

        function testConfigLoad() {
            addLog('üîç Testando carregamento de configura√ß√£o...', 'info');
            
            try {
                if (typeof window.getFirebaseConfig === 'function') {
                    const config = window.getFirebaseConfig();
                    addLog('‚úÖ Fun√ß√£o getFirebaseConfig encontrada', 'success');
                    addLog(`üìã Configura√ß√£o retornada: ${config ? 'Objeto v√°lido' : 'Null/undefined'}`, config ? 'success' : 'error');
                    
                    if (config) {
                        addLog(`üîë API Key: ${config.apiKey ? config.apiKey.substring(0, 10) + '...' : 'N√£o encontrada'}`, config.apiKey ? 'success' : 'error');
                        addLog(`üìÇ Project ID: ${config.projectId || 'N√£o encontrado'}`, config.projectId ? 'success' : 'error');
                    }
                } else {
                    addLog('‚ùå Fun√ß√£o getFirebaseConfig n√£o encontrada', 'error');
                }
            } catch (error) {
                addLog(`‚ùå Erro ao testar configura√ß√£o: ${error.message}`, 'error');
            }
        }

        async function testFirebaseInit() {
            addLog('üöÄ Testando inicializa√ß√£o Firebase...', 'info');
            
            try {
                if (typeof FirebaseConfigManager !== 'undefined') {
                    addLog('‚úÖ FirebaseConfigManager encontrado', 'success');
                    
                    const configManager = new FirebaseConfigManager();
                    addLog('‚úÖ Inst√¢ncia criada', 'success');
                    
                    try {
                        const config = await configManager.loadConfig();
                        addLog('‚úÖ loadConfig() executado sem erros', 'success');
                        addLog(`üìã Config v√°lido: ${!!config}`, config ? 'success' : 'error');
                    } catch (configError) {
                        addLog(`‚ö†Ô∏è Erro esperado em loadConfig(): ${configError.message}`, 'warning');
                    }
                    
                } else {
                    addLog('‚ùå FirebaseConfigManager n√£o encontrado', 'error');
                }
                
                // Testar fun√ß√£o de configura√ß√£o universal
                if (typeof window.getFirebaseConfig === 'function') {
                    try {
                        const config = window.getFirebaseConfig();
                        addLog('‚úÖ getFirebaseConfig() chamado com sucesso', 'success');
                    } catch (uniError) {
                        addLog(`‚ö†Ô∏è getFirebaseConfig() falhou: ${uniError.message}`, 'warning');
                    }
                }
                
            } catch (error) {
                addLog(`‚ùå Erro geral na inicializa√ß√£o: ${error.message}`, 'error');
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üéØ Teste de din√¢mica iniciado', 'info');
            addLog('üí° Clique em "Injetar Vari√°veis de Teste" para come√ßar', 'info');
            updateVarStatus();
        });

        // Log de carregamento de scripts
        window.addEventListener('load', function() {
            addLog('üìú Todos os scripts carregados', 'success');
            
            // Verificar disponibilidade de fun√ß√µes
            const functions = ['getFirebaseConfig', 'FirebaseConfigManager'];
            functions.forEach(funcName => {
                const available = typeof window[funcName] !== 'undefined';
                addLog(`üîß ${funcName}: ${available ? 'Dispon√≠vel' : 'N√£o encontrado'}`, available ? 'success' : 'error');
            });
        });
    </script>
</body>
</html>