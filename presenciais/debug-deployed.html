<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - HTML Deployado</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border-left: 4px solid #ff4444; }
        .success { background: #e6ffe6; border-left: 4px solid #44ff44; }
        .info { background: #e6f3ff; border-left: 4px solid #4488ff; }
        pre { background: #222; color: #fff; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Verifica√ß√£o do HTML Deployado</h1>
        
        <div class="result info">
            <h3>üìã Informa√ß√µes B√°sicas</h3>
            <p><strong>URL atual:</strong> <span id="currentUrl"></span></p>
            <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
        </div>

        <div class="result">
            <h3>üîë Verifica√ß√£o de Vari√°veis Firebase</h3>
            <div id="firebaseVars"></div>
        </div>

        <div class="result">
            <h3>üìÑ An√°lise do HTML</h3>
            <div id="htmlAnalysis"></div>
        </div>

        <div class="result">
            <h3>üåê Fetch do HTML Atual</h3>
            <button onclick="fetchCurrentHTML()" style="padding: 10px 20px; font-size: 16px;">üîÑ Buscar HTML Real</button>
            <div id="fetchResult"></div>
        </div>
    </div>

    <script>
        // Informa√ß√µes b√°sicas
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('timestamp').textContent = new Date().toLocaleString();
        document.getElementById('userAgent').textContent = navigator.userAgent;

        // Verificar vari√°veis Firebase
        function checkFirebaseVars() {
            const vars = {
                'window.FIREBASE_CONFIG': window.FIREBASE_CONFIG,
                'window.FIREBASE_API_KEY': window.FIREBASE_API_KEY,
                'window.FIREBASE_AUTH_DOMAIN': window.FIREBASE_AUTH_DOMAIN,
                'window.FIREBASE_PROJECT_ID': window.FIREBASE_PROJECT_ID,
                'window.FIREBASE_STORAGE_BUCKET': window.FIREBASE_STORAGE_BUCKET,
                'window.FIREBASE_MESSAGING_SENDER_ID': window.FIREBASE_MESSAGING_SENDER_ID,
                'window.FIREBASE_APP_ID': window.FIREBASE_APP_ID
            };

            let html = '<table border="1" style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th>Vari√°vel</th><th>Presente</th><th>Tipo</th><th>Valor (mascarado)</th></tr>';

            for (const [key, value] of Object.entries(vars)) {
                const present = value !== undefined && value !== null;
                const type = typeof value;
                const maskedValue = present ? 
                    (type === 'string' && value.length > 10 ? value.substring(0, 8) + '...' : String(value).substring(0, 20) + '...') 
                    : 'undefined';
                
                html += `<tr>
                    <td>${key}</td>
                    <td>${present ? '‚úÖ' : '‚ùå'}</td>
                    <td>${type}</td>
                    <td>${maskedValue}</td>
                </tr>`;
            }
            html += '</table>';

            document.getElementById('firebaseVars').innerHTML = html;
        }

        // An√°lise do HTML atual
        function analyzeHTML() {
            const htmlContent = document.documentElement.outerHTML;
            const analysis = {
                'Cont√©m FIREBASE_API_KEY': htmlContent.includes('FIREBASE_API_KEY'),
                'Cont√©m FIREBASE_CONFIG': htmlContent.includes('FIREBASE_CONFIG'),
                'Cont√©m firebase-config-local.js': htmlContent.includes('firebase-config-local.js'),
                'Cont√©m firebase-config-universal.js': htmlContent.includes('firebase-config-universal.js'),
                'Cont√©m firebase-config-safe.js': htmlContent.includes('firebase-config-safe.js'),
                'Scripts Firebase encontrados': (htmlContent.match(/window\.FIREBASE_/g) || []).length
            };

            let html = '<table border="1" style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th>Verifica√ß√£o</th><th>Resultado</th></tr>';

            for (const [check, result] of Object.entries(analysis)) {
                html += `<tr>
                    <td>${check}</td>
                    <td>${typeof result === 'boolean' ? (result ? '‚úÖ' : '‚ùå') : result}</td>
                </tr>`;
            }
            html += '</table>';

            document.getElementById('htmlAnalysis').innerHTML = html;
        }

        // Fetch do HTML atual
        async function fetchCurrentHTML() {
            const resultDiv = document.getElementById('fetchResult');
            resultDiv.innerHTML = '<p>üîÑ Buscando HTML...</p>';

            try {
                const response = await fetch(window.location.href);
                const htmlContent = await response.text();
                
                // Procurar por scripts Firebase
                const firebaseScripts = [];
                const scriptRegex = /<script[^>]*>([\s\S]*?)<\/script>/gi;
                let match;
                
                while ((match = scriptRegex.exec(htmlContent)) !== null) {
                    if (match[1].includes('FIREBASE_') || match[1].includes('Firebase')) {
                        firebaseScripts.push(match[1].trim());
                    }
                }

                let html = '<h4>üìä Resultados:</h4>';
                html += `<p><strong>Status:</strong> ${response.status} ${response.statusText}</p>`;
                html += `<p><strong>Tamanho:</strong> ${htmlContent.length} caracteres</p>`;
                html += `<p><strong>Scripts Firebase encontrados:</strong> ${firebaseScripts.length}</p>`;

                if (firebaseScripts.length > 0) {
                    html += '<h4>üî• Scripts Firebase no HTML:</h4>';
                    firebaseScripts.forEach((script, index) => {
                        html += `<h5>Script ${index + 1}:</h5>`;
                        html += `<pre>${script.substring(0, 500)}${script.length > 500 ? '\n... (truncado)' : ''}</pre>`;
                    });
                } else {
                    html += '<p class="error">‚ùå Nenhum script Firebase encontrado no HTML!</p>';
                }

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Erro ao buscar HTML: ${error.message}</p>`;
            }
        }

        // Executar verifica√ß√µes iniciais
        checkFirebaseVars();
        analyzeHTML();

        console.log('üîç Debug tool carregado');
        console.log('üìä Vari√°veis window:', {
            FIREBASE_CONFIG: !!window.FIREBASE_CONFIG,
            FIREBASE_API_KEY: !!window.FIREBASE_API_KEY,
            hostname: window.location.hostname
        });
    </script>
</body>
</html>