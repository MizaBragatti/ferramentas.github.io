<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de PresenÃ§a - Aulas Musicais</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .auth-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-size: 1.2rem;
            color: #8c8c8c;
        }
        .auth-protected { display: none; }
    </style>
</head>
<body>
    <div id="authLoading" class="auth-loading">
        <div>ğŸ”’ Verificando autenticaÃ§Ã£o...</div>
    </div>
    <div class="container auth-protected" id="mainContent">
        <header>
            <div class="header-content">
                <div>
                    <h1>ğŸµ Sistema de PresenÃ§a</h1>
                    <p class="subtitle">GestÃ£o de Aulas Musicais aos SÃ¡bados</p>
                </div>
                <div class="user-menu" id="userMenu" style="display: none;">
                    <span id="userName"></span>
                    <button onclick="handleLogout()" class="btn-logout">Sair</button>
                </div>
            </div>
        </header>

        <nav class="main-nav">
            <a href="presenca.html" class="nav-button">
                <span class="icon">ğŸ“‹</span>
                <span>Marcar PresenÃ§a</span>
            </a>
            <a href="cadastro.html" class="nav-button">
                <span class="icon">ğŸ‘¥</span>
                <span>Cadastro de Alunos</span>
            </a>
            <a href="reports.html" class="nav-button">
                <span class="icon">ğŸ“Š</span>
                <span>RelatÃ³rios</span>
            </a>
            <a href="modulos.html" class="nav-button">
                <span class="icon">ğŸ“š</span>
                <span>GestÃ£o de MÃ³dulos</span>
            </a>
        </nav>

        <div class="welcome-section">
            <h2>Bem-vindo ao Sistema de Controle de PresenÃ§a</h2>
            <p>Sistema para gerenciar presenÃ§a em aulas musicais com controle modular.</p>
            
            <div class="info-cards">
                <div class="info-card">
                    <h3>ğŸ“… Estrutura do Curso</h3>
                    <ul>
                        <li><strong>4 MÃ³dulos por ano</strong></li>
                        <li><strong>4 Fases por mÃ³dulo</strong></li>
                        <li>Aulas todos os sÃ¡bados</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>âš ï¸ Sistema de Alertas</h3>
                    <ul>
                        <li><strong class="warning">25% de faltas:</strong> Aviso preventivo</li>
                        <li><strong class="critical">40% de faltas:</strong> Deve repetir mÃ³dulo</li>
                        <li>CÃ¡lculo automÃ¡tico por mÃ³dulo</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ğŸ“Š Funcionalidades</h3>
                    <ul>
                        <li>Cadastro de alunos com ID automÃ¡tico</li>
                        <li>Registro de presenÃ§a por mÃ³dulo/fase</li>
                        <li>RelatÃ³rios detalhados de frequÃªncia</li>
                        <li>ExportaÃ§Ã£o de dados</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p>Sistema de PresenÃ§a - Aulas Musicais &copy; 2025</p>
        </footer>
    </div>

    <script type="module">
        import { requireAuth, logout } from './js/auth.js';
        import DataManager from './js/data.js';

        // Require authentication
        requireAuth().then(async (user) => {
            // Hide loading, show content
            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // Show user menu
            document.getElementById('userMenu').style.display = 'flex';
            document.getElementById('userName').textContent = user.displayName || user.email;
            
            // Initialize data
            await DataManager.init();

            // Check if there's local data to migrate
            const hasLocalData = await DataManager.hasLocalDataToMigrate();
            if (hasLocalData) {
                const shouldMigrate = confirm(
                    'ğŸ”„ Detectamos dados no armazenamento local!\n\n' +
                    'Deseja migrar seus dados para a nuvem (Firebase)?\n\n' +
                    'Isso permitirÃ¡ acessar seus dados de qualquer dispositivo.\n\n' +
                    'Clique OK para migrar ou Cancelar para manter apenas local.'
                );

                if (shouldMigrate) {
                    const result = await DataManager.migrateToFirebase();
                    if (result.success) {
                        alert('âœ… ' + result.message + '\n\nSeus dados agora estÃ£o na nuvem!');
                    } else {
                        alert('âŒ ' + result.message);
                    }
                }
            }
        }).catch(() => {
            // Redirects to login automatically
        });

        // Logout handler
        window.handleLogout = async () => {
            if (confirm('Deseja realmente sair?')) {
                await logout();
            }
        };
    </script>
</body>
</html>
